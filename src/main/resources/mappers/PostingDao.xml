<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.forum.projectlzy.dao.PostingDao">

    <resultMap id="Posting" type="com.forum.projectlzy.entity.Posting">
        <id property="id" column="id"/>
        <result property="publisher" column="publisher"/>
        <result property="publishTime" column="publish_time"/>
        <result property="postingState" column="state"/>
        <result property="title" column="title"/>
        <result property="content" column="content"/>
        <result property="lastReplyTime" column="last_reply_time"/>
        <result property="favoriteNumber" column="favorite_number"/>
        <result property="postingType" column="type"/>
    </resultMap>


    <select id="findByPageAndSort" resultMap="Posting">
        select * from posting
        <where>
            <if test="search != null and search !=''">
                (title like "%"#{search}"%" or content like "%"#{search}"%" or publisher like "%"#{search}"%")
            </if>
            <if test="posting.id !=null">
                and id = #{posting.id}
            </if>
            <if test="posting.publisher !=null">
                and publisher=#{posting.publisher}
            </if>
            <if test="posting.postingState !=null">
                and state=#{posting.postingState}
            </if>
            <if test="posting.title !=null">
                and title=#{posting.title}
            </if>
            <if test="posting.postingType !=null">
                and type=#{posting.postingType}
            </if>
        </where>
        <if test="sortRule !=null and sortPropertyName!=null and sortRule !='' and sortPropertyName!=''">
            order by ${sortPropertyName} ${sortRule}
        </if>
        <if test="pageNumber !=null and limitNumber !=null">
            limit ${pageNumber} ,${limitNumber}
        </if>
    </select>

    <select id="countBySearch" resultType="java.lang.Integer">
        select count(*) from posting
        <where>
            <if test="search != null and search !=''">
                (title like "%"#{search}"%" or content like "%"#{search}"%")
            </if>
            <if test="type !=null">
                and type=#{type}
            </if>
        </where>
    </select>

    <insert id="insertByEntity" parameterType="com.forum.projectlzy.entity.Posting" useGeneratedKeys="true"
            keyProperty="id">
        insert into posting
        values (null, #{publisher}, #{publishTime}, 1, #{title}, #{content}, #{lastReplyTime}, 0, #{postingType})
    </insert>

    <select id="findById" resultMap="Posting">
        select * from posting where id = #{id}
    </select>

</mapper>